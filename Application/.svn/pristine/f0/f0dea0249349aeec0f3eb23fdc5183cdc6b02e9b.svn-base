webpackJsonp([17],{"2Nuc":function(t,e,a){"use strict";var s={name:"Marking",props:{markType:{type:String,default:"person"},tableData:{type:Array,default:function(){return[]}}},methods:{validate:function(){for(var t=0;t<this.tableData.length;t++){var e=this.tableData[t];if(!e.userscore&&"0"!=e.userscore)return this.$refs["scoreInput"+t].focus(),this.$msg("请先填写得分"),!1}return!0},getMarkInfo:function(){var t=[];return this.tableData.map(function(e){if(6==e.dttype){var a=void 0;t.map(function(t){t.tkid==e.tkid&&(a=t)}),a?a.childtk.push({userscore:e.userscore,comment:e.comment}):t.push({answerid:e.answerid,tktype:6,userid:e.userid,tkid:e.tkid,childtk:[{userscore:e.userscore,comment:e.comment}]})}else t.push({answerid:e.answerid,tktype:e.tktype,userid:e.userid,tkid:e.tkid,userscore:e.userscore,comment:e.comment})}),t},objectSpanMethod:function(t){var e=t.row;t.column,t.rowIndex;if(t.columnIndex<2&&6==e.dttype)return 0===e.xtindex?{rowspan:e.siblings_num,colspan:1}:{rowspan:0,colspan:0}}},filters:{answer:function(t,e){if(void 0!==t){var a=t.toString();return""===a?"--":4==e?"1"===a?"正确":"错误":a}}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{attrs:{data:t.tableData,"span-method":t.objectSpanMethod}},[a("el-table-column",{attrs:{label:"序号",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.tkindex+1))]}}])}),t._v(" "),"question"===t.markType?a("el-table-column",{attrs:{label:"考生",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.username))]}}],null,!1,1495375691)}):a("el-table-column",{attrs:{label:"题目类别",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(6==e.row.dttype?"组合题":e.row.type_name))]}}])}),t._v(" "),"question"!==t.markType?a("el-table-column",{attrs:{label:"题目"},scopedSlots:t._u([{key:"default",fn:function(e){return[6==e.row.dttype&&0==e.row.xtindex?a("div",{staticClass:"big-question-title",domProps:{innerHTML:t._s(e.row.dttitle)}}):t._e(),t._v("\n      "+t._s(6==e.row.dttype?e.row.xtindex+1+")、":"")+"\n      "),6==e.row.dttype?a("span",[t._v("【"+t._s(e.row.type_name)+"】")]):t._e(),t._v(" "),a("span",{domProps:{innerHTML:t._s(e.row.title)}}),t._v(" "),1!=e.row.tktype?a("div",{staticClass:"ks-color-info"},[t._v("正确答案："+t._s(t._f("answer")(e.row.tkinfo.answer,e.row.tktype)))]):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.row.analysis_flag,expression:"scope.row.analysis_flag"}],staticClass:"ks-color-info ks-mt5",domProps:{innerHTML:t._s("题目解析："+e.row.tkinfo.analysis||"无")}}),t._v(" "),a("div",{staticClass:"ks-mt5"},[a("span",{staticClass:"ks-cursor-pointer ks-color-primary",on:{click:function(t){e.row.analysis_flag=!e.row.analysis_flag}}},[t._v(t._s(e.row.analysis_flag?"隐藏解析":"查看解析"))])])]}}],null,!1,2509620596)}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"考生答案"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("answer")(e.row.useranswer,e.row.tktype)))]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"120px",label:"分数",prop:"score"}}),t._v(" "),a("el-table-column",{attrs:{label:"得分",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return a("ks-input-number",{ref:"scoreInput"+e.$index,attrs:{unit:"分",max:Number(e.row.score)},model:{value:e.row.userscore,callback:function(a){t.$set(e.row,"userscore",a)},expression:"scope.row.userscore"}})}}])}),t._v(" "),a("el-table-column",{attrs:{label:"点评"},scopedSlots:t._u([{key:"default",fn:function(e){return a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.row.comment,callback:function(a){t.$set(e.row,"comment",a)},expression:"scope.row.comment"}})}}])})],1)},staticRenderFns:[]};var r=a("C7Lr")(s,n,!1,function(t){a("Rj26")},"data-v-630c0fce",null);e.a=r.exports},N7hR:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("ZLEe"),n=a.n(s),r=a("0xDb"),i=a("2Nuc"),o=a("g+M4"),l={name:"ParperMarking",components:{Marking:i.a},data:function(){return{loaded:!1,tableData:[],id:0,paperid:0,paperDetail:{}}},activated:function(){this.dataInit(),this.getAnswerDetail()},methods:{dataInit:function(){this.loaded=!1,this.tableData=[],this.id=this.$route.query.id,this.paperid=this.$route.query.paperid,this.paperDetail={}},getAnswerDetail:function(){var t=this,e={isadmin:0,id:this.id,paperid:this.paperid};Object(o.j)(e).then(function(e){if("success"===e.result){t.paperDetail=e.detail;var a=[],s=-1;e.list.map(function(t){t.tklist.map(function(t){s++,6==t.tktype?t.useranswer.map(function(e,i){var o=t.tkinfo.childtk[i],l=Object(r.b)(t);n()(e).map(function(t){l[t]=e[t]}),l.dtinfo=t.tkinfo,l.tkinfo=Object(r.b)(o.tkinfo),l.title=o.title,l.type_name=o.type_name,l.siblings_num=t.useranswer.length,l.dttype=6,l.analysis_flag=!1,l.dttitle=t.title,l.tkindex=s,l.xtindex=i,a.push(l)}):(t.analysis_flag=!1,t.tkindex=s,a.push(t))})}),t.tableData=a}t.loaded=!0})},handleCommand:function(t){2==t.type&&this.del(t.id)},htmlFilter:function(t){return t?t.replace(/<[^>]+>/g,""):""},save:function(){var t=this;if(this.$refs.marking.validate()){var e=this.$refs.marking.getMarkInfo();Object(o.d)({answerList:e,paperid:this.paperid}).then(function(e){"success"===e.result&&(t.$notify({title:"成功",message:"批阅成功",type:"success"}),setTimeout(function(){t.$router.back()},1e3))})}}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.loaded?a("ks-container",[a("div",{staticClass:"ks-breadcrumb"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("a",{on:{click:function(e){return t.$router.back()}}},[t._v("待批卷列表")])]),t._v(" "),a("el-breadcrumb-item",[t._v("批改试卷")])],1)],1),t._v(" "),a("el-row",{staticClass:"paper-info"},[a("el-col",{attrs:{span:6}},[t._v("试卷名称："+t._s(t.paperDetail.title||"--"))]),t._v(" "),a("el-col",{attrs:{span:6}},[t._v("考生："+t._s(t.paperDetail.username||"--"))]),t._v(" "),a("el-col",{attrs:{span:6}},[t._v("用时："+t._s(t.paperDetail.time||"0"))]),t._v(" "),a("el-col",{attrs:{span:6}},[t._v("\n      得分：\n      "),a("span",{staticClass:"ks-color-primary"},[t._v(t._s(t.paperDetail.sumscore||"0")+"分")]),t._v(" "),a("span",{staticClass:"ks-color-info"},[t._v("(客观题由系统自动计算得分)")])])],1),t._v(" "),t.tableData.length?a("div",[a("marking",{ref:"marking",attrs:{"table-data":t.tableData}}),t._v(" "),a("div",{staticClass:"ks-mt20",attrs:{align:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.save()}}},[t._v("确定保存")]),t._v(" "),a("el-button",{on:{click:function(e){return t.$router.back()}}},[t._v("取消返回")])],1)],1):a("div",[a("div",{staticClass:"ks-empty"},[t._v("暂无可批阅的题目")])])],1):t._e()},staticRenderFns:[]};var u=a("C7Lr")(l,c,!1,function(t){a("Ymzq")},"data-v-10860390",null);e.default=u.exports},Rj26:function(t,e){},Ymzq:function(t,e){}});