webpackJsonp([14],{"2Nuc":function(t,e,a){"use strict";var s={name:"Marking",props:{markType:{type:String,default:"person"},tableData:{type:Array,default:function(){return[]}}},methods:{validate:function(){for(var t=0;t<this.tableData.length;t++){var e=this.tableData[t];if(!e.userscore&&"0"!=e.userscore)return this.$refs["scoreInput"+t].focus(),this.$msg("请先填写得分"),!1}return!0},getMarkInfo:function(){var t=[];return this.tableData.map(function(e){if(6==e.dttype){var a=void 0;t.map(function(t){t.tkid==e.tkid&&(a=t)}),a?a.childtk.push({userscore:e.userscore,comment:e.comment}):t.push({answerid:e.answerid,tktype:6,userid:e.userid,tkid:e.tkid,childtk:[{userscore:e.userscore,comment:e.comment}]})}else t.push({answerid:e.answerid,tktype:e.tktype,userid:e.userid,tkid:e.tkid,userscore:e.userscore,comment:e.comment})}),t},objectSpanMethod:function(t){var e=t.row;t.column,t.rowIndex;if(t.columnIndex<2&&6==e.dttype)return 0===e.xtindex?{rowspan:e.siblings_num,colspan:1}:{rowspan:0,colspan:0}}},filters:{answer:function(t,e){if(void 0!==t){var a=t.toString();return""===a?"--":4==e?"1"===a?"正确":"错误":a}}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{attrs:{data:t.tableData,"span-method":t.objectSpanMethod}},[a("el-table-column",{attrs:{label:"序号",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.tkindex+1))]}}])}),t._v(" "),"question"===t.markType?a("el-table-column",{attrs:{label:"考生",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.username))]}}],null,!1,1495375691)}):a("el-table-column",{attrs:{label:"题目类别",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(6==e.row.dttype?"组合题":e.row.type_name))]}}])}),t._v(" "),"question"!==t.markType?a("el-table-column",{attrs:{label:"题目"},scopedSlots:t._u([{key:"default",fn:function(e){return[6==e.row.dttype&&0==e.row.xtindex?a("div",{staticClass:"big-question-title",domProps:{innerHTML:t._s(e.row.dttitle)}}):t._e(),t._v("\n      "+t._s(6==e.row.dttype?e.row.xtindex+1+")、":"")+"\n      "),6==e.row.dttype?a("span",[t._v("【"+t._s(e.row.type_name)+"】")]):t._e(),t._v(" "),a("span",{domProps:{innerHTML:t._s(e.row.title)}}),t._v(" "),1!=e.row.tktype?a("div",{staticClass:"ks-color-info"},[t._v("正确答案："+t._s(t._f("answer")(e.row.tkinfo.answer,e.row.tktype)))]):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.row.analysis_flag,expression:"scope.row.analysis_flag"}],staticClass:"ks-color-info ks-mt5",domProps:{innerHTML:t._s("题目解析："+e.row.tkinfo.analysis||"无")}}),t._v(" "),a("div",{staticClass:"ks-mt5"},[a("span",{staticClass:"ks-cursor-pointer ks-color-primary",on:{click:function(t){e.row.analysis_flag=!e.row.analysis_flag}}},[t._v(t._s(e.row.analysis_flag?"隐藏解析":"查看解析"))])])]}}],null,!1,2509620596)}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"考生答案"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("answer")(e.row.useranswer,e.row.tktype)))]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"120px",label:"分数",prop:"score"}}),t._v(" "),a("el-table-column",{attrs:{label:"得分",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return a("ks-input-number",{ref:"scoreInput"+e.$index,attrs:{unit:"分",max:Number(e.row.score)},model:{value:e.row.userscore,callback:function(a){t.$set(e.row,"userscore",a)},expression:"scope.row.userscore"}})}}])}),t._v(" "),a("el-table-column",{attrs:{label:"点评"},scopedSlots:t._u([{key:"default",fn:function(e){return a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.row.comment,callback:function(a){t.$set(e.row,"comment",a)},expression:"scope.row.comment"}})}}])})],1)},staticRenderFns:[]};var n=a("C7Lr")(s,r,!1,function(t){a("Rj26")},"data-v-630c0fce",null);e.a=n.exports},HZny:function(t,e){},NT9J:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("ZLEe"),r=a.n(s),n=a("2Nuc"),i=a("0xDb"),o=a("g+M4"),l={name:"BatchMarking",components:{Marking:n.a},data:function(){return{loaded:!1,current:0,batchMode:1,tableDatas:[],peopleList:[],paperid:this.$route.query.paperid,paperName:"",saved:[]}},methods:{dataInit:function(){this.current=0,this.batchMode=1,this.tableDatas=[],this.peopleList=[],this.paperid=this.$route.query.paperid,this.paperName="",this.saved=[]},getPaperAnswers:function(){var t=this;this.loaded=!1;var e={paperid:this.paperid,type:this.batchMode};Object(o.e)(e).then(function(e){if("success"==e.result){t.paperName=e.title,t.current=(e.saved[e.saved.length-1]||1)-1,t.saved=e.saved;var a=[];e.list.map(function(e){var s=[];1==t.batchMode?(e.answerList.map(function(t,a){if(6==e.tktype){var n=t.useranswer.filter(function(t){return t.tktype});t.useranswer=n,t.useranswer.map(function(n,o){var l=Object(i.b)(t);r()(n).map(function(t){l[t]=n[t]}),l.dtinfo=e.tkinfo,l.tkinfo=Object(i.b)(e.tkinfo.childtk[o].tkinfo),l.siblings_num=t.useranswer.length,l.dttype=6,l.analysis_flag=!1,l.dttitle=e.title,l.tkindex=a,l.xtindex=o,s.push(l)})}else{var o=Object(i.b)(e);r()(t).map(function(e){o[e]=t[e]}),o.tkindex=a,o.analysis_flag=!1,s.push(o)}}),a.push({title:e.title,tktype:e.tktype,score:e.score,tkinfo:e.tkinfo,answerList:s})):2==t.batchMode&&(e.answerList.map(function(t,a){if(6==t.tktype){var n=t.useranswer.filter(function(t){return t.tktype});t.useranswer=n,t.useranswer.map(function(n,o){var l=t.tkinfo.childtk[o],c=Object(i.b)(t);r()(n).map(function(t){c[t]=n[t]}),c.dtinfo=e.tkinfo,c.tkinfo=Object(i.b)(l.tkinfo),c.title=l.title,c.type_name=l.type_name,c.siblings_num=t.useranswer.length,c.dttype=6,c.analysis_flag=!1,c.dttitle=e.title,c.tkindex=a,c.xtindex=o,s.push(c)})}else{var o=Object(i.b)(t);o.tkindex=a,o.analysis_flag=!1,s.push(o)}}),a.push({username:e.username,answerList:s}))}),t.tableDatas=a}t.loaded=!0})},getCardItemType:function(t){if(t-1==this.current||this.getCardItemPlain(t))return"primary"},getCardItemPlain:function(t){var e=this,a=!1;return this.saved.map(function(s){s==t&&t-1!=e.current&&(a=!0)}),a},next:function(){var t=this;if(this.tableDatas.length>=this.current+1&&this.$refs.marking.validate()){var e=this.$refs.marking.getMarkInfo();Object(o.d)({answerList:e,paperid:this.paperid}).then(function(e){"success"===e.result&&(t.saved.includes(t.current+1)||t.saved.push(t.current+1),t.current+1<t.tableDatas.length?t.current++:t.saved.length==t.tableDatas.length&&(t.$notify({title:"成功",message:"您已批阅完成",type:"success"}),setTimeout(function(){t.$router.back(-1)},1e3)))})}},prev:function(){if(this.current<=0)return!1;this.current--}},activated:function(){this.dataInit(),this.getPaperAnswers()},watch:{batchMode:function(t){this.getPaperAnswers()}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.loaded?a("ks-container",{staticClass:"batch-marking"},[a("div",{staticClass:"ks-breadcrumb"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("a",{on:{click:function(e){return t.$router.back()}}},[t._v("待批卷列表")])]),t._v(" "),a("el-breadcrumb-item",[t._v("批量阅卷")])],1)],1),t._v(" "),a("div",{staticClass:"batch-marking__paper-name"},[t._v("\n    "+t._s(t.paperName)+"\n    "),t.tableDatas.length&&t.tableDatas.length==t.saved.length?a("el-tag",{staticClass:"ks-ml10",attrs:{size:"small"}},[t._v("已批阅完成")]):t._e()],1),t._v(" "),a("div",{staticClass:"batch-marking__mode"},[t.tableDatas.length?a("div",{staticClass:"ks-fr"},[a("div",{staticClass:"batch-marking__progress"},[2==t.batchMode&&t.tableDatas[t.current]?a("span",{staticClass:"ks-mr15"},[t._v("当前考生："+t._s(t.tableDatas[t.current].username))]):t._e(),t._v("\n        批卷进度:"+t._s(t.current+1)+"/"+t._s(t.tableDatas.length)+"    \n        "),a("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[a("div",{staticClass:"batch-marking-card"},t._l(t.tableDatas.length,function(e){return a("el-button",{key:e,attrs:{size:"small",type:t.getCardItemType(e),plain:t.getCardItemPlain(e)},on:{click:function(a){t.current=e-1}}},[t._v(t._s(e))])}),1),t._v(" "),a("el-button",{attrs:{slot:"reference"},slot:"reference"},[t._v("答题卡")])],1)],1)]):t._e(),t._v(" "),a("el-radio-group",{model:{value:t.batchMode,callback:function(e){t.batchMode=e},expression:"batchMode"}},[a("el-radio-button",{attrs:{label:"1"}},[t._v("按题型顺序")]),t._v(" "),a("el-radio-button",{attrs:{label:"2"}},[t._v("按人员顺序")])],1)],1),t._v(" "),t.tableDatas.length?a("div",[1==t.batchMode?a("div",[a("div",{staticClass:"batch-marking__tk-title"},[t._v("\n        题目内容：\n        "),a("span",{staticClass:"ks-fr ks-color-primary"},[t._v(t._s(t.tableDatas[t.current].score)+"分")])]),t._v(" "),a("div",{staticClass:"batch-marking__tk-content"},[a("div",{domProps:{innerHTML:t._s(t.current+1+" 、 "+t.tableDatas[t.current].title)}}),t._v(" "),6==t.tableDatas[t.current].tktype?a("div",t._l(t.tableDatas[t.current].tkinfo.childtk,function(e,s){return a("div",{key:s,domProps:{innerHTML:t._s(s+1+")、【"+e.type_name+"】 "+e.title)}})}),0):t._e()]),t._v(" "),t.tableDatas[t.current]?a("marking",{ref:"marking",staticClass:"ks-mt20",attrs:{"mark-type":"question","table-data":t.tableDatas[t.current].answerList}}):t._e()],1):2==t.batchMode?a("div",{staticClass:"ks-mt20"},[t.tableDatas[t.current]?a("marking",{ref:"marking",attrs:{"table-data":t.tableDatas[t.current].answerList}}):t._e()],1):t._e(),t._v(" "),a("div",{staticClass:"ks-mt20",attrs:{align:"center"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.current>=1,expression:"current >= 1"}],on:{click:function(e){return t.prev()}}},[t._v(t._s(1==this.batchMode?"返回上一题":2==this.batchMode&&"返回上一位"))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.next()}}},[t._v("保存"+t._s((1==this.batchMode&&t.tableDatas.length>t.current+1?"进入下一题":2==this.batchMode&&t.tableDatas.length>t.current+1&&"进入下一位")||""))])],1)]):a("div",{staticClass:"ks-empty"},[t._v("暂无批改内容")])]):t._e()},staticRenderFns:[]};var u=a("C7Lr")(l,c,!1,function(t){a("HZny")},"data-v-5b11cd16",null);e.default=u.exports},Rj26:function(t,e){}});