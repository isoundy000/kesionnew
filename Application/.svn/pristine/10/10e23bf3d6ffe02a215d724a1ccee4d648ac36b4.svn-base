webpackJsonp([53],{SOvU:function(e,t){},wvzy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("0xDb"),r=a("EGQN"),o=a("Bdu3"),l=a("Foau"),s={name:"AddData",data:function(){return{loaded:!1,visible:!1,loadSelectData:!0,fileType:"",form:{},rules:{title:[{required:!0,message:"请输入资料名称"}],intro:[{required:!0,message:"请输入资料介绍"}]}}},methods:{uploadData:function(){var e=this;this.$store.ready(function(t){e.$aliUpload({wxid:t.info.wxid,type:"data",uploaded:function(t){e.form.file_path=t.path,e.form.file_name=t.file.name,e.form.size=t.file.size}})})},chooseExisting:function(){this.loadSelectData=!0,this.visible=!0},setPrice:function(){var e=this.form.price.match(/\d+\.?\d{0,2}/),t=e?e[0]:"";this.form.price=t},onSubmit:function(){var e=this;this.$refs.dataForm.validate(function(t){if(t){if(!e.form.file_path)return void e.$msg("请先上传资料");if(1==e.form.chargetype&&parseFloat(e.form.price)<=0)return void e.$msg("收费价格必须大于0");var a=Object(i.b)(e.form);a.isopen=a.isopen?1:0,Object(l.b)(a).then(function(t){"success"===t.result&&e.$msg(t.msg,"success").then(function(t){e.$router.back()})})}})},selectDataCallback:function(e){this.visible=!1,this.form.file_name=e[0].file_name,this.form.file_path=e[0].file_path,this.form.size=e[0].size}},activated:function(){var e=this;this.loaded=!1,this.visible=!1,this.loadSelectData=!0,this.dataName="";var t=this.$route.params.id;t>0?Object(l.g)({id:t}).then(function(t){if("success"===t.result){var a=t.detail;a.isopen=1==a.isopen,e.form=a}e.loaded=!0}):(this.form={id:"0",title:"",intro:"",isopen:!0,chargetype:"0",file_path:"",file_name:"",price:"",down_num:"0"},this.loaded=!0)},components:{SelectData:o.a,DataFormat:r.a}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.loaded?a("ks-container",{staticClass:"add-data"},[a("div",{staticClass:"ks-breadcrumb"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/?url=/home.html/materials/Index?appid-14"}}},[e._v("资料列表")]),e._v(" "),a("el-breadcrumb-item",[e._v("添加资料")])],1)],1),e._v(" "),a("el-form",{ref:"dataForm",staticClass:"ks-mt30",attrs:{rules:e.rules,model:e.form,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"资料标题",prop:"title",required:""}},[a("el-input",{attrs:{maxlength:"50"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资料介绍",prop:"intro",required:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.intro,callback:function(t){e.$set(e.form,"intro",t)},expression:"form.intro"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上传资料",required:""}},[a("el-button",{attrs:{type:"primary"},on:{click:e.uploadData}},[e._v("本地上传")]),e._v(" "),a("el-button",{on:{click:e.chooseExisting}},[e._v("选择已有文件")]),e._v(" "),a("br"),e._v(" "),e.form.file_name?a("data-format",{attrs:{"file-name":e.form.file_name}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"资料价格"}},[a("el-radio",{attrs:{label:"0"},model:{value:e.form.chargetype,callback:function(t){e.$set(e.form,"chargetype",t)},expression:"form.chargetype"}},[e._v("免费")]),e._v(" "),a("el-radio",{attrs:{label:"1"},model:{value:e.form.chargetype,callback:function(t){e.$set(e.form,"chargetype",t)},expression:"form.chargetype"}},[e._v("收费")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.form.chargetype,expression:"form.chargetype == 1"}],staticClass:"add-data__price-input"},[e._v("\n        资料价格：\n        "),a("el-input",{staticStyle:{width:"200px"},on:{change:e.setPrice},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}}),e._v("元\n      ")],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"下载次数"}},[a("ks-input-number",{staticStyle:{width:"100px"},model:{value:e.form.down_num,callback:function(t){e.$set(e.form,"down_num",t)},expression:"form.down_num"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发布状态"}},[a("el-switch",{attrs:{"active-color":e.$store.state.switch_on,"inactive-color":e.$store.state.switch_off},model:{value:e.form.isopen,callback:function(t){e.$set(e.form,"isopen",t)},expression:"form.isopen"}})],1)],1),e._v(" "),a("div",{staticClass:"add-data-footer",attrs:{align:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存设置")]),e._v(" "),a("el-button",{on:{click:function(t){return e.$router.back(-1)}}},[e._v("取消")])],1),e._v(" "),a("el-dialog",{attrs:{title:"选择资料",width:"920px",visible:e.visible},on:{"update:visible":function(t){e.visible=t},closed:function(t){e.loadSelectData=!1}}},[e.loadSelectData?a("select-data",{on:{cancel:function(t){e.visible=!1},sure:e.selectDataCallback}}):e._e()],1)],1):e._e()},staticRenderFns:[]};var c=a("C7Lr")(s,n,!1,function(e){a("SOvU")},"data-v-0ec43748",null);t.default=c.exports}});