webpackJsonp([23],{"6Z+f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("FJ1s"),n={name:"WxMsgReply",props:["replyUser"],data:function(){return{chatList:[],loading:!0}},methods:{getChatList:function(){var t=this;Object(a.h)({fromusername:this.replyUser.fromusername}).then(function(e){"success"===e.result?(e.list.map(function(e){e.content=t.$refs.wxEditor.codeReplaceToEmotion(e.content)}),t.chatList=e.list,t.$nextTick(function(){t.$refs.chatScrollView.scrollTop=t.$refs.chatScrollView.scrollHeight})):t.$msg(e.msg),t.loading=!1})},sendMsg:function(){var t=this,e=this.$refs.wxEditor.getContent();if(!e)return this.$msg("请先输入回复内容"),!1;Object(a.o)({fromusername:this.replyUser.tousername,content:e,tousername:this.replyUser.fromusername}).then(function(e){"success"===e.result?(t.getChatList(),t.$refs.wxEditor.setContent("")):t.$msg("该会话已超过时间限制，回复失败")})}},mounted:function(){this.getChatList()},components:{WxEditor:s("1h17").a}},i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wx-msg-reply"},[s("div",{staticClass:"wx-msg-reply_user_tip"},[t._v("\n    与\n    "),s("span",{staticClass:"ks-red"},[t._v(t._s(t.replyUser.nickname))]),t._v("的聊天记录\n  ")]),t._v(" "),s("div",{staticClass:"wx-msg-reply__chat"},[s("div",{ref:"chatScrollView",staticClass:"wx-msg-reply__chat__list clearfix"},[s("ks-loading",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]}),t._v(" "),t._l(t.chatList,function(e){return s("div",{key:e.id,staticClass:"clearfix",class:e.nickname?"wx-msg-reply__chat__item":"wx-msg-reply__chat__item_me"},[s("ks-create-bg",{staticClass:"wx-msg-reply__chat__avatar",attrs:{type:"user",src:e.headimgurl}}),t._v(" "),s("div",{staticClass:"wx-msg-reply__chat__cont",domProps:{innerHTML:t._s(e.content)}})],1)})],2),t._v(" "),s("wx-editor",{ref:"wxEditor",staticClass:"wx-msg-reply__reply",attrs:{height:"120px"}}),t._v(" "),s("div",{staticClass:"clearfix ks-mt10"},[s("el-button",{staticClass:"ks-fr",attrs:{type:"primary"},on:{click:t.sendMsg}},[t._v("确认发送")])],1)],1)])},staticRenderFns:[]};var r={name:"WxMsgList",data:function(){return{visible:!1,replyUser:{},tableData:[],keyword:"",pagination:{total:0,current:0}}},methods:{getDataList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.$showLoading(),Object(a.g)({p:e,keyword:this.keyword,maxperpage:10}).then(function(e){e.list.map(function(t){t.nickname=t.nickname||"游客",t.city=t.city||"未知",t.checked=!1}),t.tableData=e.list,t.pagination.total=e.page.total_pages,t.pagination.current=e.page.now_page,t.$hideLoading()})},deleteItem:function(t){var e=this;Object(a.b)({fromusername:t}).then(function(t){"success"===t.result?e.$msg("删除成功","success").then(function(){e.getDataList()}):e.$msg(t.msg)})},replyMsg:function(t){this.replyUser=t,this.visible=!0}},mounted:function(){this.getDataList()},components:{WxMsgReply:s("C7Lr")(n,i,!1,function(t){s("dqx5")},"data-v-6f15c3be",null).exports}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wx-msg-list"},[s("el-dialog",{attrs:{title:"消息回复",visible:t.visible,width:"640px"},on:{"update:visible":function(e){t.visible=e}}},[t.visible?s("wx-msg-reply",{attrs:{"reply-user":t.replyUser}}):t._e()],1),t._v(" "),s("div",{staticClass:"ks-mt30 ks-pd20 clearfix"},[s("el-input",{staticClass:"ks-max-w-fit",attrs:{placeholder:"请输入搜索内容"},on:{change:function(e){return t.getDataList()}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[s("i",{staticClass:"el-icon-search el-input__icon ks-cursor-pointer",attrs:{slot:"suffix"},on:{click:function(e){return t.getDataList()}},slot:"suffix"})])],1),t._v(" "),s("el-table",{staticClass:"wx-msg-list__table",attrs:{data:t.tableData}},[s("el-table-column",{attrs:{label:"选择",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-checkbox",{model:{value:e.row.checked,callback:function(s){t.$set(e.row,"checked",s)},expression:"scope.row.checked"}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"用户头像",width:"160"},scopedSlots:t._u([{key:"default",fn:function(t){return s("ks-create-bg",{staticClass:"wx-msg-list__table__avatar",attrs:{type:"user",src:t.row.headimgurl}})}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"nickname",label:"昵称"}}),t._v(" "),s("el-table-column",{attrs:{prop:"city",label:"城市",width:"200"}}),t._v(" "),s("el-table-column",{attrs:{label:"消息管理",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("共"+t._s(e.row.readNum)+"条 | "+t._s(e.row.noreadNum)+"未读")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"消息管理",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return s("el-button",{on:{click:function(s){return t.replyMsg(e.row)}}},[t._v("消息回复")])}}])})],1),t._v(" "),t.tableData.length?s("ks-table-footer",{attrs:{pagination:t.pagination,"select-key":"fromusername","table-data":t.tableData,"delete-call-type":"array"},on:{"current-change":t.getDataList,trigger:t.deleteItem}}):t._e()],1)},staticRenderFns:[]};var c=s("C7Lr")(r,l,!1,function(t){s("e2tO")},"data-v-3babc1dc",null);e.default=c.exports},dqx5:function(t,e){},e2tO:function(t,e){}});