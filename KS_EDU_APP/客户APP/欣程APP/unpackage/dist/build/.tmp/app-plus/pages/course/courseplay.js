(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/course/courseplay"],{"04d1":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i})},"21d6":function(e,t,n){"use strict";n.r(t);var o=n("b6f1"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);t["default"]=i.a},4395:function(e,t,n){"use strict";var o=n("c73e"),i=n.n(o);i.a},a0cc:function(e,t,n){"use strict";(function(e){n("661b"),n("921b");o(n("66fd"));var t=o(n("a4fd"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},a4fd:function(e,t,n){"use strict";n.r(t);var o=n("04d1"),i=n("21d6");for(var a in i)"default"!==a&&function(e){n.d(t,e,function(){return i[e]})}(a);n("4395");var s=n("2877"),r=Object(s["a"])(i["default"],o["a"],o["b"],!1,null,null,null);t["default"]=r.exports},b6f1:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("60b3")),i=n("a5e9");function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){return Promise.all([n.e("common/vendor"),n.e("components/ks-components/comment-list/comment-list")]).then(n.bind(null,"d3f5"))},r=function(){return Promise.all([n.e("common/vendor"),n.e("lib/polyv/components/chatroom/chatroom")]).then(n.bind(null,"abd0"))},c=function(){return Promise.all([n.e("common/vendor"),n.e("lib/polyv/components/player/player")]).then(n.bind(null,"fbaeb"))},l=function(){return n.e("components/ks-components/course-exam/course-exam").then(n.bind(null,"ca60"))},d=function(){return Promise.all([n.e("common/vendor"),n.e("components/ks-components/course-notes/course-notes")]).then(n.bind(null,"bea1"))},u={components:{polyvChatroom:r,polyvPlayer:c,CommentList:s,CourseExam:l,CourseNotes:d},data:function(){return{baseUrl:this.$store.state.SRC+"/config/app",courseid:0,newScrollLeft:0,expand:!1,scrollLeft:0,videoOption:{},liveStatus:-1,learnStatus:-1,learnContent:"",msg:"",playType:-1,costype:-1,videoSrc:"",title:"",current:0,currentTab:0,oldPeriodList:[],periodList:[],tabs:["课时","讨论","试卷","笔记"],state:{}}},onLoad:function(t){var n=this;this.$store.ready(function(o){n.state=o,n.courseid=t.courseid,(0,i.getCourseCatalog)({courseid:t.courseid}).then(function(o){if(n.periodList=o.periods,n.oldPeriodList=o.periods,o.periods.length){var i=0;t.periodid&&n.periodList.map(function(e,n){e.periodid==t.periodid&&(i=n)}),n.periodTap(o.periods[i]),n.$nextTick(function(){var t=e.createSelectorQuery().in(n);t.select(".catalog-slide-item--active").boundingClientRect(function(e){n.scrollLeft=e.left}).exec()})}n.costype=o.catalogData.Course.teachway,n.title=o.catalogData.CourseName})})},methods:{openDownload:function(){e.navigateTo({url:"/pages/user/local/download?courseid=".concat(this.courseid)})},toggleExpand:function(){this.expand=!this.expand},setMsg:function(e){this.learnStatus=0,this.msg=e},getPlayVod:function(t){var n=this;switch(Number(t.teachWay)){case 5:(0,i.PlayLive)({courseid:this.courseid,periodid:t.periodid}).then(function(e){if(e.result)switch(n.liveStatus=Number(e.liveStatus),n.learnStatus=1,n.liveStatus){case 0:n.setMsg("直播未开始");break;case 1:switch(Number(e.liveType)){case 1:n.handlerPolyvLive(n.liveStatus,e.roomId,e.vid);break;default:n.setMsg("不支持的直播类型")}break;case 2:switch(Number(e.playType)){case 0:n.videoSrc=n.$handleSrc(e.vid),n.playType=0;break;case 5:n.handlerPolyvLive(n.liveStatus,e.roomId,e.vid);break;default:n.setMsg("直播已结束")}break}else n.setMsg(e.msg)});break;default:switch(Number(t.type)){case 0:(0,i.PlayVod)({courseid:this.courseid,periodid:t.periodid}).then(function(o){var i=0;if(1==t.islistening&&(i=t.listeningSeconds),o.result)switch(n.playType=Number(o.playType),n.learnStatus=1,Number(o.playType)){case 5:n.videoOption={mode:"vod",vid:o.vid,ts:o.getTs,sign:o.getSign},n.playType=5,n.createLearnExample({audition:i,courseid:n.courseid,periodid:n.current,costype:n.costype});break;case 0:n.videoSrc=o.vid,n.createLearnExample({audition:i,courseid:n.courseid,periodid:n.current,costype:n.costype}),n.$nextTick(function(){var t=e.createVideoContext("courseVideo",n);n.onVideoContextChange({videoContext:t})});break;default:n.setMsg("不支持的视频来源");break}else n.setMsg(o.msg)});break;case 1:this.setMsg("暂不支持音频课件预览");break;case 2:this.playType=200,this.learnContent=t.intro,this.learnStatus=1,this.createLearnExample({type:2,courseid:this.courseid,periodid:this.current,costype:this.costype});break;case 3:this.setMsg("暂不支持PDF课件预览");default:this.setMsg("不支持的课件类型")}}},handlerPolyvLive:function(e,t,n){var o=this;switch(e){case 0:this.setMsg("直播未开始");case 1:this.$store.ready(function(e){var n=1==e.isLogin?e.userInfo.UserID:Math.ceil(1e13*Math.random()),i=1==e.isLogin?e.userInfo.RealName||e.userInfo.UserName:"游客"+n,a=1==e.isLogin?e.userInfo.UserFace:"";o.$plvInit({channelId:t,userName:i,avatarUrl:a,openId:n}).then(function(e){var t=e.detail;e.chat;o.playType=5,o.videoOption={mode:"live",uid:t.userId,cid:t.roomId,isAutoChange:!1}})});break;case 2:if(!n)return void this.setMsg("直播已结束");this.videoOption={mode:"vod",vid:n},this.playType=5;break}},onScroll:function(e){this.newScrollLeft=e.detail.scrollLeft},onTabChange:function(e){var t=this;"课时"===e.tab&&this.$nextTick(function(){t.scrollLeft=t.newScrollLeft})},periodTap:function(e){this.current=e.periodid,1==e.$isCanLearn?this.getPlayVod(e):this.setMsg("需要购买后才能学习该课时")},onVideoContextChange:function(e){this.videoContext=e.videoContext},createLearnExample:function(e){var t=this;e.onAuditionEnded=function(){t.videoContext.stop(),t.setMsg("试听结束，购买课程后可继续观看")},e.onSaveCallback=function(e){"nopower"==e&&(t.videoContext.stop(),t.setMsg("对不起，您的学习次数已到，无权进入学习"))},this.playLearnExample?this.playLearnExample.init(e):this.playLearnExample=new o.default(e)},onVideoPlay:function(e){this.playLearnExample&&this.playLearnExample.onplay(e)},onVideoPause:function(e){this.playLearnExample&&this.playLearnExample.onpause(e)},onVideoEnded:function(e){var t=this;this.playLearnExample&&this.playLearnExample.onended(e);var n=0;this.periodList.map(function(e,o){e.periodid==t.current&&(n=o)});var o=this.periodList[n+1];o&&1==o.$isCanLearn&&this.periodTap(o)},onVideoTimeupdate:function(e){this.playLearnExample&&this.playLearnExample.ontimeupdate(e)}},destroyed:function(){this.$plvDestory()}};t.default=u}).call(this,n("6e42")["default"])},c73e:function(e,t,n){}},[["a0cc","common/runtime","common/vendor"]]]);