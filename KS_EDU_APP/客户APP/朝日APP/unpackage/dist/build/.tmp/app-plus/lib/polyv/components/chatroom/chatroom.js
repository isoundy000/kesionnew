(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["lib/polyv/components/chatroom/chatroom"],{"097e":function(t,n,o){"use strict";var i=o("c00f"),e=o.n(i);e.a},"27bb":function(t,n,o){"use strict";o.r(n);var i=o("9704"),e=o.n(i);for(var c in i)"default"!==c&&function(t){o.d(n,t,function(){return i[t]})}(c);n["default"]=e.a},3187:function(t,n,o){"use strict";o.r(n);var i=o("937a"),e=o("27bb");for(var c in e)"default"!==c&&function(t){o.d(n,t,function(){return e[t]})}(c);o("097e");var a=o("2877"),s=Object(a["a"])(e["default"],i["a"],i["b"],!1,null,"f761c170",null);n["default"]=s.exports},"937a":function(t,n,o){"use strict";var i=function(){var t=this,n=t.$createElement;t._self._c},e=[];o.d(n,"a",function(){return i}),o.d(n,"b",function(){return e})},9704:function(t,n,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=a(o("7990")),e=a(o("a7c3")),c=a(o("9154"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{},i=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),i.forEach(function(n){r(t,n,o[n])})}return t}function r(t,n,o){return n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function h(t){return f(t)||l(t)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function f(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}var d=function(){return o.e("lib/polyv/components/chat-list/chat-list").then(o.bind(null,"617e"))},v=function(){return Promise.all([o.e("common/vendor"),o.e("lib/polyv/components/chat-edit/chat-edit")]).then(o.bind(null,"9e72"))},p={components:{ChatList:d,ChatEdit:v},props:{showBulletin:{type:Boolean,default:!1},skin:{type:String,default:"black"}},data:function(){return{chatList:[],hasMore:!1,scrollTop:0,isOnlyHost:!1,comeMore:!1}},created:function(){this.chatEvent=this.getChatEvent(),this.notJoinLists=[],this.clock=null,this.chat=null,this.chatTop=0,this.scrollHeight=0,this.chatListHeight=0},beforeMount:function(){var t=this;e.default.getDomRect(".plv-mp-chatroom-scroll-view",this).then(function(n){var o=n.height;t.scrollHeight=o})},mounted:function(){var t=this;this.unsub=c.default.get({"main.chat":function(n){t.chat=n,n&&(t.bindEvent(t.chatEvent),t.chat.getHistoryMessage(20,0),t.initChatListQueue())}})},destroyed:function(){var t=this;if(this.unsub(),clearInterval(this.clock),this.chat){var n=this.chatEvent;Object.keys(n).forEach(function(o){t.chat.off(o,n[o])}),this.chat=null}},methods:{handleSeeMore:function(){this.chat.hasMoreHistory()&&this.chat.getHistoryMessage()},handleLike:function(){this.chat.sendLike(1)},handleSendMsg:function(t){var n=t.chatTitle;this.chat.send(n),this.isSelfMsg=!0},handleOnlyHost:function(t){var n=t.isOnlyHost;this.isOnlyHost=n},handleSeeMoreMsg:function(){this.comeMore=!1,this.chatScrollToBottom()},onChatListScroll:function(t){this.chatTop=t.scrollTop,this.comeMore&&this.chatTop+this.scrollHeight+10>=this.chatListHeight&&(this.comeMore=!1)},handleShowBulletin:function(){this.$emit("onTapBulletin")},bindEvent:function(t){var n=this.chat;n&&Object.keys(t).forEach(function(o){n.on(o,t[o])})},getChatEvent:function(){var t,n=this;return t={},r(t,i.default.HISTORY_MESSAGE,function(t,o){var i=0===n.chatList.length,e=[].concat(h(o),h(n.chatList));n.chatList=e,n.hasMore=n.chat.hasMoreHistory(),n.$nextTick(function(){i&&n.chatScrollToBottom()})}),r(t,i.default.SPEAK,function(t,o){var i=!1;try{n.chatList.forEach(function(t){if(t.id===o.id)throw i=!0,Error("same id")})}catch(n){}!i&&n.notJoinLists.push(o)}),r(t,i.default.CHAT_IMG,function(t,o){o.content=o.values[0],n.notJoinLists.push(o)}),r(t,i.default.REMOVE_HISTORY,function(){n.chatList=[],n.hasMore=!1}),r(t,i.default.REMOVE_CONTENT,function(t,o){var i=h(n.chatList);i.forEach(function(t,e){t.id===o.id&&(i.splice(e,1),n.chatList=i)})}),r(t,i.default.SYSTEM_MESSAGE,function(t,o){n.notJoinLists.push(o)}),r(t,i.default.SPEAK_ERROR,function(t,o){n.notJoinLists.push(o)}),r(t,i.default.SEND_MESSAGE,function(t,o){n.chatList=[].concat(h(n.chatList),[o]),n.$nextTick(function(){n.chatScrollToBottom()})}),r(t,i.default.SPEAK_CENSOR,function(t,o){var i="chatList[".concat(n.chatList.length-1,"].id");n[i]=o.id}),r(t,i.default.REWARD,function(t,o){n.notJoinLists.push(s({},o,{id:Math.floor(1e7*Math.random())}))}),r(t,i.default.LIKES,function(t,o){n.notJoinLists.push(s({},o,{id:Math.floor(1e7*Math.random())}))}),r(t,i.default.FLOWERS,function(t,o){n.notJoinLists.push(s({},o,{id:Math.floor(1e7*Math.random())}))}),r(t,i.default.CLOSE_ROOM,function(){n.notJoinLists.push({id:Math.floor(1e7*Math.random()),system:!0,content:"房间暂时关闭"})}),r(t,i.default.OPEN_ROOM,function(){n.notJoinLists.push({id:Math.floor(1e7*Math.random()),system:!0,content:"房间已经打开"})}),r(t,i.default.KICK_USER,function(t,o){n.notJoinLists.push({system:!0,content:"".concat(o.user.nick,"[被踢出房间]")})}),t},initChatListQueue:function(){var t=this;this.clock=setInterval(function(){if(t.notJoinLists.length){var n=t.chatListHeight-2*t.scrollHeight<=t.chatTop,o=[].concat(h(t.chatList),h(t.notJoinLists));o.length>200&&(o=o.slice(200)),t.chatList=o,t.notJoinLists=[],t.$nextTick(function(){n?t.chatScrollToBottom():(e.default.getDomRect("#chatList",t).then(function(n){var o=n.height;t.chatListHeight=o}),t.comeMore=!t.isSelfMsg,t.isSelfMsg=!1)})}},600)},chatScrollToBottom:function(){var t=this;e.default.getDomRect("#chatList",this).then(function(n){var o=n.height;t.chatListHeight=o,t.scrollTop=o})}}};n.default=p},c00f:function(t,n,o){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'lib/polyv/components/chatroom/chatroom-create-component',
    {
        'lib/polyv/components/chatroom/chatroom-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('6e42')['createComponent'](__webpack_require__("3187"))
        })
    },
    [['lib/polyv/components/chatroom/chatroom-create-component']]
]);
