(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/local/index"],{"167d":function(t,e,s){"use strict";var i=s("973a"),o=s.n(i);o.a},"5a18":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=(t._self._c,t.__map(t.JSONList,function(e,s){var i=t.__map(e.taskList,function(s,i){var o=t.activeList.indexOf(e.courseid+"_"+s.periodid);return{$orig:t.__get_orig(s),g0:o}});return{$orig:t.__get_orig(e),l0:i}}));t.$mp.data=Object.assign({},{$root:{l1:s}})},o=[];s.d(e,"a",function(){return i}),s.d(e,"b",function(){return o})},"737b":function(t,e,s){"use strict";(function(t){s("3099"),s("921b");i(s("66fd"));var e=i(s("d7bb"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("6e42")["createPage"])},"86ba":function(t,e,s){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s("1cad");function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var n={data:function(){var t;return t={deletes:!1,JSONList:[],activeList:[],url:"",query:{},state:{},newTaskData:{},src:"",show:!1},a(t,"activeList",[]),a(t,"all",!1),a(t,"platform",""),t},watch:{"$store.state.JSONList":{handler:function(t){this.JSONList=t},deep:!0,immediate:!0}},onNavigationBarButtonTap:function(){this.rightBtn()},methods:{rightBtn:function(){if(this.deletes){this.deletes=!1;t=this.$mp.page.$getAppWebview();t.setTitleNViewButtonStyle(0,{text:"管理"})}else{this.deletes=!0;var t=this.$mp.page.$getAppWebview();t.setTitleNViewButtonStyle(0,{text:"完成"})}},showkeshi:function(t){t.showkeshi=!t.showkeshi,this.$set(t,"showkeshi",t.showkeshi)},openPlayer:function(e){console.log(t(e.task.filename," at pages\\user\\local\\index.vue:141"));var s=plus.io.convertLocalFileSystemURL(e.task.filename);console.log(t(s," at pages\\user\\local\\index.vue:143")),this.src="file://"+s,i.navigateTo({url:"/pages/user/local/player?src=".concat(this.src)})},videoErrorCallback:function(e){console.log(t(e," at pages\\user\\local\\index.vue:151")),i.showToast({icon:"none",title:e.target.errMsg})},deletesTask:function(){var e=this;this.activeList.length>0&&i.showModal({title:"删除所选内容",content:"确定删除所选内容吗?",success:function(s){s.confirm?e.activeList.map(function(s){var i=s.split("_"),o=i[0],a=i[1];plus.io.resolveLocalFileSystemURL("_doc/video/".concat(e.state.userId,"/").concat(o,"/").concat(a,"/"),function(s){s.removeRecursively(function(s){console.log(t("删除成功"," at pages\\user\\local\\index.vue:171")),e.rightBtn(),e.$store.state.JSONList.map(function(t,s){t.courseid==o&&(t.taskList=t.taskList.filter(function(t,e){if(t.periodid!=a)return t}),e.$set(t,"taskList",t.taskList),e.$set(e.JSONList,s,t))}),e.$store.state.JSONList=e.$store.state.JSONList.filter(function(t,e){if(t.taskList.length>0)return t}),e.writeFileJson()},function(e){console.log(t(e.message," at pages\\user\\local\\index.vue:192"))})},function(e){console.log(t(e.message," at pages\\user\\local\\index.vue:195"))})}):s.cancel&&console.log(t("用户点击取消"," at pages\\user\\local\\index.vue:200"))}})},select:function(e,s){var i="".concat(e,"_").concat(s);-1==this.activeList.indexOf(i)?this.activeList.push(i):this.activeList=this.activeList.filter(function(t){if(t!=i)return t});var o=[];this.$store.state.JSONList.map(function(t){t.taskList.map(function(e){o.push("".concat(t.courseid,"_").concat(e.periodid))})}),this.all=o.length==this.activeList.length,console.log(t(this.activeList," at pages\\user\\local\\index.vue:224"))},allSelect:function(){var e=this;this.all=!this.all,this.all?this.$store.state.JSONList.map(function(t){t.taskList.map(function(s){e.activeList.push("".concat(t.courseid,"_").concat(s.periodid))})}):this.activeList=[],console.log(t(this.activeList," at pages\\user\\local\\index.vue:239"))},meiju:function(){},resumes:function(e,s){this.$store.state.JSONList.map(function(i){i.courseid==e&&i.taskList.map(function(e){e.periodid==s.periodid&&(console.log(t(e.task.resume," at pages\\user\\local\\index.vue:253")),e.task.resume())})})},pauses:function(e,s){var i=this;this.$store.state.JSONList.map(function(o){o.courseid==e&&o.taskList.map(function(e){e.periodid==s.periodid&&(console.log(t(e.task.pause," at pages\\user\\local\\index.vue:270")),e.task.pause(),i.writeFileJson())})})},writeFileJson:function(){var e=this;plus.io.requestFileSystem(plus.io.PRIVATE_DOC,function(s){s.root.getFile("cache/".concat(e.state.userId,".txt"),{create:!0},function(s){s.toURL();s.createWriter(function(s){s.write(JSON.stringify(e.$store.state.JSONList)),console.log(t("写入成功"," at pages\\user\\local\\index.vue:290"))},function(e){console.log(t("写入失败,"+e.message," at pages\\user\\local\\index.vue:292"))})})},function(e){console.log(t("我是调用失败的回调"," at pages\\user\\local\\index.vue:296"))})},getJsonTxt:function(){var e=this;plus.io.resolveLocalFileSystemURL("_doc/cache/".concat(this.state.userId,".txt"),function(s){var i=new plus.io.FileReader;i.readAsText(s),i.onload=function(s){0==e.$store.state.JSONList.length&&(e.$store.state.JSONList=JSON.parse(s.target.result)),console.log(t(e.JSONList.length,e.$store.state.JSONList.length," at pages\\user\\local\\index.vue:313")),e.query.periodids&&e.newTask()}},function(s){e.query.periodids&&e.newTask(),console.log(t(s.message," at pages\\user\\local\\index.vue:323"))})},newTask:function(){var e=this;(0,o.DownLoadCourse)({courseid:this.query.courseid,periodids:[this.query.periodids]}).then(function(s){console.log(t(s," at pages\\user\\local\\index.vue:335")),s.showkeshi=!0;var i=[];i=e.$store.state.JSONList.map(function(t){return t.courseid});var o=i.indexOf(s.courseid);if(-1==o){var a={};a.courseid=s.courseid,a.coursename=s.coursename,a.taskList=s.data,a.showkeshi=s.showkeshi,e.$store.state.JSONList.unshift(a),o=0}else e.$store.state.JSONList[o].taskList=s.data.concat(e.$store.state.JSONList[o].taskList);var n=s.data.map(function(t){return t.periodid});if(console.log(t(e.$store.state.JSONList[o].imageUrl," at pages\\user\\local\\index.vue:358")),!e.$store.state.JSONList[o].imageUrl){var c=plus.downloader.createDownload("http://192.168.1.2:70/UploadFiles/2019/112/D132200028367716.jpg",{filename:"_doc/video/".concat(e.state.userId,"/").concat(e.query.courseid,"/").concat(e.query.courseid,".jpg")},function(s,i){200==i?(console.log(t("下载成功"," at pages\\user\\local\\index.vue:367")),e.$store.state.JSONList[o].imageUrl="file://"+plus.io.convertLocalFileSystemURL("_doc/video/".concat(e.state.userId,"/").concat(e.query.courseid,"/").concat(e.query.courseid,".jpg")),console.log(t(e.$store.state.JSONList[o].imageUrl," at pages\\user\\local\\index.vue:370"))):console.log(t("下载失败"," at pages\\user\\local\\index.vue:373"))});c.start()}e.$store.state.JSONList[o].taskList.map(function(s){if(console.log(t(s.download1," at pages\\user\\local\\index.vue:380")),-1!=n.indexOf(s.periodid)){s.state=0,s.totalSize=0,s.downloadedSize=0,s.percent=0,s.id=0;s.periodid;var i=plus.downloader.createDownload(s.download1,{filename:"_doc/video/".concat(e.state.userId,"/").concat(e.query.courseid,"/").concat(s.periodid,"/").concat(s.periodid,".mp4")},function(e,s){200==s?console.log(t("下载成功"," at pages\\user\\local\\index.vue:394")):console.log(t("下载失败"," at pages\\user\\local\\index.vue:396"))});i.addEventListener("statechanged",function(t,i){s.download1==t.url&&(s.state=t.state,s.totalSize=(t.totalSize/1e6).toFixed(1),s.downloadedSize=(t.downloadedSize/1e6).toFixed(1),s.percent=Math.floor(t.downloadedSize/t.totalSize*100),e.$set(s,"state",s.state),e.$set(s,"totalSize",s.totalSize),e.$set(s,"downloadedSize",s.downloadedSize),e.$set(s,"percent",s.percent),e.$set(e.$store.state.JSONList[o].taskList,n.indexOf(s.periodid),s),4==t.state&&200==i&&e.writeFileJson())},!1),i.start(),s.task=i}})})},taskStart:function(){},onStateChanged:function(e,s){console.log(t(e.state," at pages\\user\\local\\index.vue:441"))},startDownload:function(){this.$store.state.JSONList.map(function(t){t.task.start()})},ready:function(){var t=this;plus?this.getJsonTxt():setTimeout(function(){t.ready()},100)}},onLoad:function(t){var e=this;i.getSystemInfo({success:function(t){e.platform=t.platform}}),i.setNavigationBarTitle({title:t.title}),this.query=t,this.$store.ready(function(t){e.state=t,e.ready()})}};e.default=n}).call(this,s("0de9")["default"],s("6e42")["default"])},"973a":function(t,e,s){},afb6:function(t,e,s){"use strict";s.r(e);var i=s("86ba"),o=s.n(i);for(var a in i)"default"!==a&&function(t){s.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},d7bb:function(t,e,s){"use strict";s.r(e);var i=s("5a18"),o=s("afb6");for(var a in o)"default"!==a&&function(t){s.d(e,t,function(){return o[t]})}(a);s("167d");var n=s("2877"),c=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,"204ca512",null);e["default"]=c.exports}},[["737b","common/runtime","common/vendor"]]]);